<template>
  <div class="floating-toolbar-demo">
    <div class="demo-header">
      <h2>ğŸ› ï¸ æµ®åŠ¨å·¥å…·æ æ¼”ç¤º</h2>
      <p>å·¥å…·æ ç°åœ¨æµ®åŠ¨åœ¨å³ä¸Šè§’ï¼Œå¯ä»¥æŠ˜å /å±•å¼€</p>
    </div>

    <div class="demo-content">
      <div class="demo-info">
        <h3>ç‰¹æ€§è¯´æ˜</h3>
        <ul>
          <li>ğŸ“ å›ºå®šåœ¨å±å¹•å³ä¸Šè§’ä½ç½®</li>
          <li>ğŸ”„ æ”¯æŒæŠ˜å /å±•å¼€åˆ‡æ¢</li>
          <li>ğŸ“± å“åº”å¼è®¾è®¡ï¼Œé€‚é…ç§»åŠ¨è®¾å¤‡</li>
          <li>ğŸ¨ åŠé€æ˜èƒŒæ™¯ï¼Œæ¯›ç»ç’ƒæ•ˆæœ</li>
          <li>ğŸŒ™ æ”¯æŒæ·±è‰²ä¸»é¢˜</li>
          <li>ğŸ“œ å†…å®¹è¿‡å¤šæ—¶è‡ªåŠ¨æ»šåŠ¨</li>
        </ul>

        <h3>å¿«æ·é”®</h3>
        <div class="shortcuts">
          <div class="shortcut-item">
            <span class="key">M</span>
            <span>ç§»åŠ¨å·¥å…·</span>
          </div>
          <div class="shortcut-item">
            <span class="key">P</span>
            <span>ç”»ç¬”</span>
          </div>
          <div class="shortcut-item">
            <span class="key">E</span>
            <span>æ©¡çš®æ“¦</span>
          </div>
          <div class="shortcut-item">
            <span class="key">F</span>
            <span>å¡«å……</span>
          </div>
          <div class="shortcut-item">
            <span class="key">L</span>
            <span>ç›´çº¿</span>
          </div>
          <div class="shortcut-item">
            <span class="key">R</span>
            <span>çŸ©å½¢</span>
          </div>
          <div class="shortcut-item">
            <span class="key">S</span>
            <span>çŸ©å½¢é€‰æ‹©</span>
          </div>
          <div class="shortcut-item">
            <span class="key">Ctrl+Z</span>
            <span>æ’¤é”€</span>
          </div>
          <div class="shortcut-item">
            <span class="key">Ctrl+Y</span>
            <span>é‡åš</span>
          </div>
        </div>

        <h3>ä½¿ç”¨è¯´æ˜</h3>
        <ol>
          <li>ç‚¹å‡»å³ä¸Šè§’çš„ âŒ æŒ‰é’®å¯ä»¥æŠ˜å å·¥å…·æ </li>
          <li>æŠ˜å åæ˜¾ç¤ºä¸º ğŸ“‹ å›¾æ ‡ï¼Œç‚¹å‡»å¯å±•å¼€</li>
          <li>å·¥å…·æŒ‰é’®é‡‡ç”¨å‚ç›´å¸ƒå±€ï¼ŒèŠ‚çœç©ºé—´</li>
          <li>æ¯ä¸ªå·¥å…·ç»„éƒ½æœ‰æ˜ç¡®çš„åˆ†ç±»æ ‡ç­¾</li>
          <li>æ”¯æŒè§¦å±è®¾å¤‡çš„touchæ“ä½œ</li>
        </ol>
      </div>

      <div class="demo-canvas">
        <h3>æ¨¡æ‹Ÿç”»å¸ƒåŒºåŸŸ</h3>
        <div class="mock-canvas">
          <div class="canvas-info">
            <p>è¿™é‡Œæ˜¯ç¼–è¾‘åŒºåŸŸ</p>
            <p>å·¥å…·æ æµ®åŠ¨åœ¨å³ä¸Šè§’</p>
            <p>ä¸ä¼šå ç”¨ç”»å¸ƒç©ºé—´</p>
            <div class="demo-pixels">
              <div
                v-for="i in 64"
                :key="i"
                class="pixel"
                :style="{ backgroundColor: getRandomColor() }"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æµ®åŠ¨å·¥å…·æ  -->
    <PixelEditorToolbar
      :current-tool="currentTool"
      :current-color="currentColor"
      :brush-size="brushSize"
      :show-grid="showGrid"
      :zoom="zoom"
      :can-undo="canUndo"
      :can-redo="canRedo"
      :selected-area="selectedArea"
      :width="canvasWidth"
      :height="canvasHeight"
      :actual-width="actualWidth"
      :actual-height="actualHeight"
      :dynamic-canvas-width="dynamicCanvasWidth"
      :dynamic-canvas-height="dynamicCanvasHeight"
      :cell-size-cm="cellSizeCm"
      :cell-size-px="cellSizePx"
      :grid-cell-width="gridCellWidth"
      :grid-cell-height="gridCellHeight"
      :grid-count="gridCount"
      :needle-count="needleCount"
      :row-count="rowCount"
      :canvas-colors="canvasColors"
      :hidden-colors="hiddenColors"
      @tool-change="handleToolChange"
      @color-change="handleColorChange"
      @brush-size-change="handleBrushSizeChange"
      @undo="handleUndo"
      @redo="handleRedo"
      @toggle-grid="handleToggleGrid"
      @clear-canvas="handleClearCanvas"
      @flip-canvas-x="handleFlipCanvasX"
      @flip-canvas-y="handleFlipCanvasY"
      @reset-view="handleResetView"
      @copy-selection="handleCopySelection"
      @cut-selection="handleCutSelection"
      @delete-selection="handleDeleteSelection"
      @clear-selection="handleClearSelection"
      @paste-selection="handlePasteSelection"
      @trigger-image-upload="handleImageUpload"
      @reset-canvas-size="handleResetCanvasSize"
      @get-canvas-colors="handleGetCanvasColors"
      @test-draw="handleTestDraw"
      @test-multi-screen="handleTestMultiScreen"
      @diagnose="handleDiagnose"
      @finish-editing="handleFinishEditing"
      @grid-cell-width-change="handleGridCellWidthChange"
      @grid-cell-height-change="handleGridCellHeightChange"
      @grid-count-width-change="handleGridCountWidthChange"
      @grid-count-height-change="handleGridCountHeightChange"
      @needle-count-change="handleNeedleCountChange"
      @row-count-change="handleRowCountChange"
      @auto-calculate-grid="handleAutoCalculateGrid"
      @reset-grid-to-default="handleResetGridToDefault"
      @zoom-in="handleZoomIn"
      @zoom-out="handleZoomOut"
      @set-color="handleSetColor"
      @toggle-color-visibility="handleToggleColorVisibility"
      @delete-color="handleDeleteColor"
      @clear-color-filters="handleClearColorFilters"
      @clear-colors-list="handleClearColorsList"
    />
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
// import PixelEditorToolbar from '../../../components/PixelEditorToolbar.vue';

// å·¥å…·æ çŠ¶æ€
const currentTool = ref('pen' as any);
const currentColor = ref('#ff0000');
const brushSize = ref(2);
const showGrid = ref(true);
const zoom = ref(1);
const canUndo = ref(true);
const canRedo = ref(false);
const selectedArea = ref(null);

// ç”»å¸ƒä¿¡æ¯
const canvasWidth = ref(64);
const canvasHeight = ref(64);
const actualWidth = ref(10);
const actualHeight = ref(10);
const dynamicCanvasWidth = ref(128);
const dynamicCanvasHeight = ref(96);

// ç½‘æ ¼ä¿¡æ¯
const cellSizeCm = ref({ width: 0.15625, height: 0.15625 });
const cellSizePx = ref({ width: 8, height: 8 });
const gridCellWidth = ref(8);
const gridCellHeight = ref(8);
const gridCount = ref({ width: 64, height: 64 });
const needleCount = ref(64);
const rowCount = ref(64);

// é¢œè‰²ç®¡ç†
const canvasColors = ref([
  '#ff0000',
  '#00ff00',
  '#0000ff',
  '#ffff00',
  '#ff00ff',
  '#00ffff',
]);
const hiddenColors = ref(new Set<string>());

// äº‹ä»¶å¤„ç†
const handleToolChange = (tool: any) => {
  currentTool.value = tool;
  console.log('å·¥å…·åˆ‡æ¢:', tool);
};

const handleColorChange = (color: string) => {
  currentColor.value = color;
  console.log('é¢œè‰²æ”¹å˜:', color);
};

const handleBrushSizeChange = (size: number) => {
  brushSize.value = size;
  console.log('ç”»ç¬”å¤§å°:', size);
};

const handleUndo = () => {
  console.log('æ’¤é”€æ“ä½œ');
  canRedo.value = true;
};

const handleRedo = () => {
  console.log('é‡åšæ“ä½œ');
  canRedo.value = false;
};

const handleToggleGrid = () => {
  showGrid.value = !showGrid.value;
  console.log('ç½‘æ ¼æ˜¾ç¤º:', showGrid.value);
};

const handleClearCanvas = () => {
  console.log('æ¸…ç©ºç”»å¸ƒ');
};

const handleFlipCanvasX = () => {
  console.log('æ°´å¹³ç¿»è½¬ç”»å¸ƒ');
};

const handleFlipCanvasY = () => {
  console.log('å‚ç›´ç¿»è½¬ç”»å¸ƒ');
};

const handleResetView = () => {
  zoom.value = 1;
  console.log('é‡ç½®è§†å›¾');
};

const handleCopySelection = () => {
  console.log('å¤åˆ¶é€‰æ‹©');
};

const handleCutSelection = () => {
  console.log('å‰ªåˆ‡é€‰æ‹©');
};

const handleDeleteSelection = () => {
  console.log('åˆ é™¤é€‰æ‹©');
};

const handleClearSelection = () => {
  selectedArea.value = null;
  console.log('æ¸…é™¤é€‰æ‹©');
};

const handlePasteSelection = () => {
  console.log('ç²˜è´´é€‰æ‹©');
};

const handleImageUpload = () => {
  console.log('ä¸Šä¼ å›¾ç‰‡');
};

const handleResetCanvasSize = () => {
  dynamicCanvasWidth.value = canvasWidth.value;
  dynamicCanvasHeight.value = canvasHeight.value;
  console.log('é‡ç½®ç”»å¸ƒå°ºå¯¸');
};

const handleGetCanvasColors = () => {
  console.log('è·å–ç”»å¸ƒé¢œè‰²');
};

const handleTestDraw = () => {
  console.log('æµ‹è¯•ç»˜åˆ¶');
};

const handleTestMultiScreen = () => {
  console.log('å¤šå±æµ‹è¯•');
};

const handleDiagnose = () => {
  console.log('è¯Šæ–­');
};

const handleFinishEditing = () => {
  console.log('å®Œæˆç¼–è¾‘');
};

const handleGridCellWidthChange = (width: number) => {
  gridCellWidth.value = width;
  console.log('ç½‘æ ¼å®½åº¦:', width);
};

const handleGridCellHeightChange = (height: number) => {
  gridCellHeight.value = height;
  console.log('ç½‘æ ¼é«˜åº¦:', height);
};

const handleGridCountWidthChange = (width: number) => {
  gridCount.value.width = width;
  console.log('ç½‘æ ¼æ•°é‡å®½åº¦:', width);
};

const handleGridCountHeightChange = (height: number) => {
  gridCount.value.height = height;
  console.log('ç½‘æ ¼æ•°é‡é«˜åº¦:', height);
};

const handleNeedleCountChange = (count: number) => {
  needleCount.value = count;
  console.log('é’ˆæ•°:', count);
};

const handleRowCountChange = (count: number) => {
  rowCount.value = count;
  console.log('è¡Œæ•°:', count);
};

const handleAutoCalculateGrid = () => {
  console.log('è‡ªåŠ¨è®¡ç®—ç½‘æ ¼');
};

const handleResetGridToDefault = () => {
  gridCellWidth.value = 8;
  gridCellHeight.value = 8;
  console.log('é‡ç½®ç½‘æ ¼é»˜è®¤å€¼');
};

const handleZoomIn = () => {
  zoom.value = Math.min(zoom.value * 1.2, 5);
  console.log('æ”¾å¤§:', zoom.value);
};

const handleZoomOut = () => {
  zoom.value = Math.max(zoom.value / 1.2, 0.1);
  console.log('ç¼©å°:', zoom.value);
};

const handleSetColor = (color: string) => {
  currentColor.value = color;
  console.log('è®¾ç½®é¢œè‰²:', color);
};

const handleToggleColorVisibility = (color: string) => {
  if (hiddenColors.value.has(color)) {
    hiddenColors.value.delete(color);
  } else {
    hiddenColors.value.add(color);
  }
  console.log('åˆ‡æ¢é¢œè‰²å¯è§æ€§:', color);
};

const handleDeleteColor = (color: string) => {
  const index = canvasColors.value.indexOf(color);
  if (index > -1) {
    canvasColors.value.splice(index, 1);
  }
  console.log('åˆ é™¤é¢œè‰²:', color);
};

const handleClearColorFilters = () => {
  hiddenColors.value.clear();
  console.log('æ¸…é™¤é¢œè‰²è¿‡æ»¤å™¨');
};

const handleClearColorsList = () => {
  canvasColors.value = [];
  console.log('æ¸…é™¤é¢œè‰²åˆ—è¡¨');
};

// ç”Ÿæˆéšæœºé¢œè‰²ç”¨äºæ¼”ç¤º
const getRandomColor = () => {
  const colors = [
    '#ff6b6b',
    '#4ecdc4',
    '#45b7d1',
    '#96ceb4',
    '#feca57',
    '#ff9ff3',
  ];
  return colors[Math.floor(Math.random() * colors.length)];
};
</script>

<style scoped>
.floating-toolbar-demo {
  min-height: 100vh;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  padding: 20px;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

.demo-header {
  text-align: center;
  color: white;
  margin-bottom: 30px;
}

.demo-header h2 {
  font-size: 2.5em;
  margin-bottom: 10px;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}

.demo-header p {
  font-size: 1.2em;
  opacity: 0.9;
}

.demo-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  max-width: 1200px;
  margin: 0 auto;
}

.demo-info {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 16px;
  padding: 30px;
  backdrop-filter: blur(10px);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.demo-info h3 {
  color: #333;
  margin-bottom: 15px;
  font-size: 1.4em;
  border-bottom: 2px solid #667eea;
  padding-bottom: 5px;
}

.demo-info ul {
  list-style: none;
  padding: 0;
}

.demo-info li {
  margin-bottom: 10px;
  padding-left: 30px;
  position: relative;
}

.demo-info li::before {
  content: 'âœ¨';
  position: absolute;
  left: 0;
  top: 0;
}

.demo-info ol {
  padding-left: 20px;
}

.demo-info ol li {
  padding-left: 10px;
}

.demo-info ol li::before {
  display: none;
}

.shortcuts {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 10px;
  margin-top: 15px;
}

.shortcut-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  background: #f8f9fa;
  border-radius: 8px;
  border: 1px solid #e9ecef;
}

.key {
  background: #343a40;
  color: white;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: bold;
  min-width: 24px;
  text-align: center;
}

.demo-canvas {
  background: rgba(255, 255, 255, 0.95);
  border-radius: 16px;
  padding: 30px;
  backdrop-filter: blur(10px);
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.demo-canvas h3 {
  color: #333;
  margin-bottom: 20px;
  font-size: 1.4em;
  border-bottom: 2px solid #667eea;
  padding-bottom: 5px;
}

.mock-canvas {
  background: #f8f9fa;
  border: 2px dashed #dee2e6;
  border-radius: 12px;
  height: 400px;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}

.canvas-info {
  text-align: center;
  color: #6c757d;
}

.canvas-info p {
  margin-bottom: 10px;
  font-size: 1.1em;
}

.demo-pixels {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  gap: 2px;
  margin-top: 20px;
  max-width: 200px;
}

.pixel {
  width: 20px;
  height: 20px;
  border-radius: 2px;
  transition: transform 0.2s;
}

.pixel:hover {
  transform: scale(1.1);
}

@media (max-width: 768px) {
  .demo-content {
    grid-template-columns: 1fr;
    gap: 20px;
  }

  .demo-header h2 {
    font-size: 2em;
  }

  .demo-info,
  .demo-canvas {
    padding: 20px;
  }

  .shortcuts {
    grid-template-columns: 1fr;
  }

  .mock-canvas {
    height: 300px;
  }
}
</style>
